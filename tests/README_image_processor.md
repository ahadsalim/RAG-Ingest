# پردازشگر تصاویر اسناد حقوقی

این ابزار برای پردازش خودکار تصاویر رای‌های وحدت رویه هیأت عمومی دیوان عالی کشور طراحی شده است.

## ویژگی‌ها

- پردازش خودکار تصاویر JPG با استفاده از هوش مصنوعی (GPT-4 Vision)
- استخراج اطلاعات ساختاریافته:
  - عنوان (شامل تاریخ رای)
  - نوع متن (رای)
  - محتوای کامل
  - تاریخ شروع اعتبار
- رابط کاربری وب برای بررسی و ویرایش
- پردازش دسته‌ای (5 تصویر در هر دسته)
- ذخیره خودکار در دیتابیس
- حذف خودکار فایل‌های پردازش شده

## نصب

```bash
pip install -r requirements_ai_image.txt
```

## استفاده

1. یک پوشه بنام `jpg` در کنار فایل `ai_image.py` ایجاد کنید

2. تصاویر JPG خود را در پوشه `jpg` کپی کنید

3. اسکریپت را اجرا کنید:
```bash
python ai_image.py
```

3. مرورگر خود را باز کنید و به آدرس زیر بروید:
```
http://localhost:5001
```

4. روی دکمه "شروع پردازش" کلیک کنید

5. هوش مصنوعی 5 تصویر اول را پردازش می‌کند و نتایج را نمایش می‌دهد

6. محتوای استخراج شده را بررسی و در صورت نیاز ویرایش کنید

7. موارد مورد نظر را تأیید کنید (یا تیک آن‌ها را بردارید)

8. روی "تأیید و ذخیره" کلیک کنید

9. رکوردها در جدول `documents_textentry` ذخیره می‌شوند و فایل‌های تصویر حذف می‌شوند

10. به طور خودکار 5 تصویر بعدی پردازش می‌شود

## ساختار تصاویر مورد انتظار

```
رای شماره: [شماره] - [تاریخ شمسی]
بسمه تعالی یا باسمه تعالی
[متن رای]
هیات عمومی دیوان عالی کشور
```

## نکات مهم

- تاریخ‌ها باید به صورت شمسی باشند (مثال: 1346/4/22)
- امضای "هیات عمومی دیوان عالی کشور" در محتوا ذخیره نمی‌شود
- فایل‌های پردازش شده به طور خودکار حذف می‌شوند
- لاگ‌ها در فایل `ai_image.log` ذخیره می‌شوند
- پاسخ‌های API در فایل‌های `batch*_response.json` ذخیره می‌شوند

## تنظیمات

در صورت نیاز، می‌توانید تنظیمات زیر را در ابتدای فایل `ai_image.py` تغییر دهید:

- `OPENAI_API_KEY`: کلید API
- `OPENAI_BASE_URL`: آدرس پایه API
- `DB_CONFIG`: تنظیمات دیتابیس
- `MODEL_NAME`: مدل هوش مصنوعی (پیش‌فرض: gpt-4o)
- `BATCH_SIZE`: تعداد تصاویر در هر دسته (پیش‌فرض: 5)

## مشاهده در Admin Panel

بعد از ذخیره، می‌توانید رکوردها را در آدرس زیر مشاهده کنید:
```
https://ingest.tejarat.chat/admin/documents/textentry
```
