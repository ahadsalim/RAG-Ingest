# Ú¯Ø²Ø§Ø±Ø´ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ ÙØ±Ø¢ÛŒÙ†Ø¯ Deployment

ØªØ§Ø±ÛŒØ®: 2025-11-15
Ù…ÙˆØ¶ÙˆØ¹: Ø§ØµÙ„Ø§Ø­ ØµÙØ­Ù‡ Ú¯Ø²Ø§Ø±Ø´ ÙØ¹Ø§Ù„ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†

## ğŸ“‹ Ø®Ù„Ø§ØµÙ‡ ØªØºÛŒÛŒØ±Ø§Øª

### 1. ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:

#### `/srv/ingest/apps/accounts/admin_views.py`
- **Ø®Ø·ÙˆØ· ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡**: 1-15, 82-98, 134-146, 197-209, 223-240, 287-289, 408-427
- **ØªØºÛŒÛŒØ±Ø§Øª**:
  - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† `from ingest.admin import admin_site`
  - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `admin_site.each_context(request)` Ø¯Ø± views
  - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† decorator `@staff_member_required`
  - ØªØºÛŒÛŒØ± Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø§Ø¯Ù‡: Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† ÙÛŒÙ„Ø¯ `date_str` Ùˆ Ù†Ú¯Ù‡â€ŒØ¯Ø§Ø±ÛŒ `date` Ø¨Ù‡ ØµÙˆØ±Øª date object
  
#### `/srv/ingest/templates/admin/accounts/user_activity_report_new.html`
- **Ø®Ø·ÙˆØ· ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡**: 1-2, 74-98, 150-173
- **ØªØºÛŒÛŒØ±Ø§Øª**:
  - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† `{% load jalali %}`
  - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø³ØªÙˆÙ† "ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ" Ø¨Ø§ ÙÛŒÙ„ØªØ± `jalali`
  - Ø¨Ù‡Ø¨ÙˆØ¯ Ù¾ÛŒØ§Ù… "Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯"
  - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `date_str` Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ

## âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ

### 1. Dependencies (requirements.txt)
- âŒ **ØªØºÛŒÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯**
- âœ… Ù‡ÛŒÚ† package Ø¬Ø¯ÛŒØ¯ÛŒ Ù†ÛŒØ§Ø² Ù†ÛŒØ³Øª
- âœ… ØªÙ…Ø§Ù… dependencies Ù…ÙˆØ¬ÙˆØ¯ Ú©Ø§ÙÛŒ Ù‡Ø³ØªÙ†Ø¯

### 2. Database Migrations
- âŒ **ØªØºÛŒÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯**
- âœ… Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø¯Ø± models Ù†Ø¯Ø§Ø±ÛŒÙ…
- âœ… Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ migration Ø¬Ø¯ÛŒØ¯ Ù†ÛŒØ³Øª

### 3. Static Files
- âŒ **ØªØºÛŒÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯**
- âœ… ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ static Ø¯Ø³Øª Ù†Ø®ÙˆØ±Ø¯Ù‡
- âœ… `collectstatic` Ø¨Ø¯ÙˆÙ† Ù…Ø´Ú©Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯

### 4. Environment Variables (.env)
- âŒ **ØªØºÛŒÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯**
- âœ… Ù‡ÛŒÚ† Ù…ØªØºÛŒØ± Ù…Ø­ÛŒØ·ÛŒ Ø¬Ø¯ÛŒØ¯ÛŒ Ù†ÛŒØ§Ø² Ù†ÛŒØ³Øª

### 5. Docker Configuration
- âŒ **ØªØºÛŒÛŒØ±ÛŒ Ù†Ø¯Ø§Ø±Ø¯**
- âœ… Dockerfile Ø¯Ø³Øª Ù†Ø®ÙˆØ±Ø¯Ù‡
- âœ… docker-compose.yml Ø¯Ø³Øª Ù†Ø®ÙˆØ±Ø¯Ù‡

## ğŸ”„ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ ÙØ±Ø¢ÛŒÙ†Ø¯ Deployment

### Ø§Ø³Ú©Ø±ÛŒÙ¾Øª `deploy_production.sh`:

```bash
# Ù…Ø±Ø§Ø­Ù„ deployment Ùˆ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ ØªØºÛŒÛŒØ±Ø§Øª:

1. âœ… Build Docker images
   - ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Python Ùˆ Template
   - Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± image Ø¬Ø¯ÛŒØ¯ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯
   - COPY . . Ø¯Ø± Dockerfile Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ú©Ù¾ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

2. âœ… Start services
   - Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ Ø¨Ø§ Ú©Ø¯ Ø¬Ø¯ÛŒØ¯ start Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
   - Ù‡ÛŒÚ† ØªØºÛŒÛŒØ±ÛŒ Ø¯Ø± docker-compose.yml Ù†Ø¯Ø§Ø±ÛŒÙ…

3. âœ… Run migrations
   - migration Ø¬Ø¯ÛŒØ¯ÛŒ Ù†Ø¯Ø§Ø±ÛŒÙ…
   - migrate Ø¨Ø¯ÙˆÙ† Ù…Ø´Ú©Ù„ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯

4. âœ… Collect static files
   - static files ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯Ù‡
   - collectstatic Ø¨Ø¯ÙˆÙ† Ù…Ø´Ú©Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯

5. âœ… Create superuser
   - ØªØºÛŒÛŒØ±ÛŒ Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ÛŒØ¬Ø§Ø¯ superuser Ù†Ø¯Ø§Ø±ÛŒÙ…
```

## ğŸ§ª ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡

### 1. Syntax Check
```bash
âœ… Python syntax: OK
âœ… All files compile: OK
```

### 2. Import Check
```bash
âœ… admin_site import: OK
âœ… admin_views imports: OK
âœ… jalali filter import: OK
âœ… template load: OK
```

### 3. Functional Test
```bash
âœ… Report generation: OK (25 records)
âœ… Date object handling: OK
âœ… Jalali conversion: OK (1404/07/26)
âœ… Real data display: OK (user: mkh, 9.22 hours)
```

### 4. Deployment Test
```bash
âœ… Docker build: OK (5.1s)
âœ… Container start: OK
âœ… No errors in logs: OK
```

## ğŸ“ Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ

### âœ… ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ú©Ø§Ù…Ù„Ø§Ù‹ Ø³Ø§Ø²Ú¯Ø§Ø± Ù‡Ø³ØªÙ†Ø¯:

1. **Ù‡ÛŒÚ† dependency Ø¬Ø¯ÛŒØ¯ÛŒ**: ØªÙ…Ø§Ù… Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø§Ø² Ù‚Ø¨Ù„ Ù†ØµØ¨ Ù‡Ø³ØªÙ†Ø¯
2. **Ù‡ÛŒÚ† migration Ø¬Ø¯ÛŒØ¯ÛŒ**: ÙÙ‚Ø· logic Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ØŒ Ø³Ø§Ø®ØªØ§Ø± database Ø¯Ø³Øª Ù†Ø®ÙˆØ±Ø¯Ù‡
3. **Ù‡ÛŒÚ† ØªØºÛŒÛŒØ± Ø¯Ø± configuration**: Docker, environment variables, Ùˆ static files Ø¯Ø³Øª Ù†Ø®ÙˆØ±Ø¯Ù‡
4. **Backward compatible**: ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ Ú©Ø¯ Ù‚Ø¨Ù„ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø± Ù‡Ø³ØªÙ†Ø¯
5. **ØªØ³Øª Ø´Ø¯Ù‡**: ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯Ù‡â€ŒØ§Ù†Ø¯

### ğŸš€ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„ Deployment:

Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ Ù…Ø¬Ø¯Ø¯ Ø¨Ø§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª `start.sh`:

```bash
cd /srv/deployment
sudo ./start.sh
# Ø§Ù†ØªØ®Ø§Ø¨ Ú¯Ø²ÛŒÙ†Ù‡ 2 (Production)
```

ÛŒØ§ Ø¨Ø±Ø§ÛŒ rebuild Ø³Ø±ÛŒØ¹:

```bash
cd /srv/deployment
docker compose -f docker-compose.ingest.yml build web
docker compose -f docker-compose.ingest.yml up -d web worker beat
```

### âš ï¸ Ù†Ú©Ø§Øª Ù…Ù‡Ù…:

1. **Cache Ù…Ø±ÙˆØ±Ú¯Ø±**: Ù¾Ø³ Ø§Ø² deployment Ø­ØªÙ…Ø§Ù‹ Ø¨Ø§ Ctrl+Shift+R ØµÙØ­Ù‡ Ø±Ø§ refresh Ú©Ù†ÛŒØ¯
2. **Ù„Ø§Ú¯â€ŒÙ‡Ø§**: Ø¯Ø± ØµÙˆØ±Øª Ù…Ø´Ú©Ù„ØŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯:
   ```bash
   docker compose -f docker-compose.ingest.yml logs -f web
   ```
3. **Health Check**: Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯:
   ```bash
   docker compose -f docker-compose.ingest.yml ps
   ```

## ğŸ¯ Ø®Ù„Ø§ØµÙ‡

**ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø¨Ø§ ÙØ±Ø¢ÛŒÙ†Ø¯ deployment Ø³Ø§Ø²Ú¯Ø§Ø± Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ù‡ÛŒÚ† Ù…Ø´Ú©Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.**

- âœ… Ú©Ø¯ Python ØµØ­ÛŒØ­ Ø§Ø³Øª
- âœ… Templateâ€ŒÙ‡Ø§ ØµØ­ÛŒØ­ Ù‡Ø³ØªÙ†Ø¯
- âœ… Importâ€ŒÙ‡Ø§ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯
- âœ… Docker build Ù…ÙˆÙÙ‚ Ø§Ø³Øª
- âœ… Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ Ø¨Ø¯ÙˆÙ† Ø®Ø·Ø§ Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- âœ… Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯

---
**ØªØ§Ø±ÛŒØ® ØªÙ‡ÛŒÙ‡**: 2025-11-15
**Ù†Ø³Ø®Ù‡**: 1.0
**ÙˆØ¶Ø¹ÛŒØª**: âœ… ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡
