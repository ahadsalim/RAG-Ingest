{% extends "admin/change_form.html" %}

{% block breadcrumbs %}
{# Ø­Ø°Ù breadcrumbs - ÙÙ‚Ø· h1 Ø¨Ø§ path Ú©Ø§Ù…Ù„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯ #}
{% endblock %}

{% block content_title %}
{# Ø­Ø°Ù content title Ø§Ø¶Ø§ÙÛŒ #}
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script>
// Ø­Ø°Ù Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
function deleteSelectedTags() {
    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† checkbox Ù‡Ø§ÛŒ ØªÛŒÚ©â€ŒØ®ÙˆØ±Ø¯Ù‡ Ø¯Ø± inline Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§
    const checkboxes = document.querySelectorAll('#legalunitvocabularyterm_set-group input[type="checkbox"][name$="-DELETE"]:checked');
    
    if (checkboxes.length === 0) {
        alert('Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¨Ø±Ú†Ø³Ø¨ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
        return;
    }
    
    if (!confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù ${checkboxes.length} Ø¨Ø±Ú†Ø³Ø¨ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) {
        return;
    }
    
    // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ ID Ù‡Ø§ÛŒ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§
    const tagIds = [];
    checkboxes.forEach(function(cb) {
        // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† hidden input Ø¨Ø§ id Ø¯Ø± Ù‡Ù…Ø§Ù† row
        const row = cb.closest('tr');
        if (row) {
            const idInput = row.querySelector('input[name$="-id"]');
            if (idInput && idInput.value) {
                tagIds.push(idInput.value);
            }
        }
    });
    
    if (tagIds.length === 0) {
        alert('Ø®Ø·Ø§: Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† ID Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯.');
        return;
    }
    
    // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­Ø°Ù
    const objectId = window.location.pathname.split('/').filter(x => x).slice(-2, -1)[0];
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
    fetch(`/admin/documents/lunit/${objectId}/delete-tags/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken
        },
        body: JSON.stringify({tag_ids: tagIds})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            // Ø±ÙØ±Ø´ ØµÙØ­Ù‡
            window.location.reload();
        } else {
            alert('Ø®Ø·Ø§: ' + (data.error || 'Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯'));
        }
    })
    .catch(error => {
        alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±: ' + error);
    });
}

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø­Ø°Ù Ø¨Ø¹Ø¯ Ø§Ø² Ù„ÙˆØ¯ ØµÙØ­Ù‡
document.addEventListener('DOMContentLoaded', function() {
    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† inline Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§
    const inlineGroup = document.getElementById('legalunitvocabularyterm_set-group');
    if (inlineGroup) {
        // Ø³Ø§Ø®Øª Ø¯Ú©Ù…Ù‡ Ø­Ø°Ù
        const deleteBtn = document.createElement('button');
        deleteBtn.type = 'button';
        deleteBtn.className = 'button';
        deleteBtn.style.cssText = 'background: #ba2121; color: white; margin: 10px 0; padding: 8px 16px; border: none; cursor: pointer; border-radius: 4px;';
        deleteBtn.innerHTML = 'ğŸ—‘ï¸ Ø­Ø°Ù Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡';
        deleteBtn.onclick = deleteSelectedTags;
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¨Ø¹Ø¯ Ø§Ø² Ø¬Ø¯ÙˆÙ„
        const table = inlineGroup.querySelector('table');
        if (table) {
            table.parentNode.insertBefore(deleteBtn, table.nextSibling);
        }
    }
});
</script>
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<style>
    /* Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ú©Ù†Ø§Ø± ÙÛŒÙ„Ø¯ parent */
    .field-parent .related-widget-wrapper-link,
    .field-parent a.related-widget-wrapper-link,
    .field-parent .related-lookup,
    .field-parent .changelink,
    .field-parent .addlink,
    .field-parent .viewlink {
        display: none !important;
        visibility: hidden !important;
    }
    
    /* Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† select Ø§ØµÙ„ÛŒ parent Ùˆ Ù†Ù…Ø§ÛŒØ´ ÙÙ‚Ø· autocomplete */
    .field-parent select {
        display: none !important;
    }
    
    /* ØªÙ†Ø¸ÛŒÙ… Ø¹Ø±Ø¶ ÙÛŒÙ„Ø¯ parent autocomplete */
    .field-parent input[type="text"],
    .field-parent .parent-autocomplete-search {
        width: 500px !important;
        display: inline-block !important;
    }
    
    /* autocomplete dropdown */
    .parent-autocomplete-results,
    .ui-autocomplete,
    .select2-dropdown,
    .autocomplete-suggestions {
        z-index: 99999 !important;
        position: absolute !important;
        background: white !important;
        border: 1px solid #ccc !important;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2) !important;
        max-height: 150px !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
    }
    
    /* Table Ùˆ container Ù‡Ø§ */
    table,
    .module,
    #content-main,
    #content {
        overflow: visible !important;
    }
    
    /* ÙÙ‚Ø· textarea overflow Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ */
    textarea {
        overflow: auto !important;
    }
    
    /* ÙØ§ØµÙ„Ù‡ Ø¨Ø±Ø§ÛŒ parent autocomplete */
    .form-row:has(.field-parent) {
        position: relative;
        margin-bottom: 180px !important;
    }
    
    /* ØªÙ†Ø¸ÛŒÙ… Ø¹Ø±Ø¶ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¬Ø§ Ø´Ø¯Ù† Ø¯Ø± ÛŒÚ© Ø®Ø· */
    .field-order_index input {
        width: 80px !important;
        display: inline-block !important;
    }
    
    .field-unit_type select {
        width: 200px !important;
        display: inline-block !important;
    }
    
    .field-number input {
        width: 100px !important;
        display: inline-block !important;
    }
    
    /* ØªÙ†Ø¸ÛŒÙ… Ø¹Ø±Ø¶ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ØªØ§Ø±ÛŒØ® */
    .field-valid_from input,
    .field-valid_to input {
        width: 150px !important;
        display: inline-block !important;
    }
    
    /* Ø­Ø°Ù bold Ø§Ø² label Ù‡Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ */
    .form-row label {
        font-weight: normal !important;
    }
    
    /* Ø­Ø°Ù bold Ø§Ø² label Ù‡Ø§ÛŒ Ø®Ø§Øµ */
    .field-order_index label,
    .field-unit_type label,
    .field-number label,
    .field-content label {
        font-weight: normal !important;
    }
    
    /* Ø­Ø°Ù Ù‡Ø± Ø®Ø· Ø§Ø¶Ø§ÙÛŒ Ø¨Ø§Ù„Ø§ÛŒ ÙØ±Ù… */
    .breadcrumbs,
    #content > h1:first-child,
    #content-main > div:first-child:not(.module),
    .submit-row + p,
    div[style*="background"] {
        display: none !important;
    }
</style>

<script>
// Shortkey F2 Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†
document.addEventListener('DOMContentLoaded', function() {
    document.addEventListener('keydown', function(e) {
        // F2 Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†
        if (e.key === 'F2') {
            e.preventDefault();
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†
            const addButton = document.querySelector('.object-tools .addlink');
            if (addButton) {
                window.location.href = addButton.href;
            }
        }
    });
});
</script>
{% endblock %}
