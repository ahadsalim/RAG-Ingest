{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<style>
    .stats-container {
        padding: 20px;
        max-width: 1400px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .stat-card h3 {
        margin-top: 0;
        color: #417690;
        font-size: 18px;
        border-bottom: 2px solid #79aec8;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }
    
    .stat-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .stat-row:last-child {
        border-bottom: none;
    }
    
    .stat-label {
        color: #666;
        font-weight: 500;
    }
    
    .stat-value {
        color: #333;
        font-weight: bold;
        direction: ltr;
        text-align: left;
    }
    
    .stat-value.large {
        font-size: 24px;
        color: #417690;
    }
    
    .error-message {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 20px;
        color: #721c24;
        margin: 20px 0;
    }
    
    .success-message {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        padding: 20px;
        color: #155724;
        margin: 20px 0;
    }
    
    .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .summary-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .summary-card.green {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    }
    
    .summary-card.blue {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .summary-card.orange {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }
    
    .summary-card.purple {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .summary-card.red {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .summary-value {
        font-size: 32px;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .summary-label {
        font-size: 14px;
        opacity: 0.9;
    }
    
    .refresh-button {
        background: #417690;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        margin-bottom: 20px;
    }
    
    .refresh-button:hover {
        background: #2e5266;
    }
    
    .timestamp {
        color: #666;
        font-size: 13px;
        margin-bottom: 20px;
    }
    
    .rating-stars {
        color: #ffc107;
        font-size: 18px;
    }
    
    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .status-green {
        background: #d4edda;
        color: #155724;
    }
    
    .status-red {
        background: #f8d7da;
        color: #721c24;
    }
    
    .tier-breakdown {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    
    .tier-item {
        flex: 1;
        text-align: center;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
    }
    
    .tier-name {
        font-size: 11px;
        color: #666;
        text-transform: uppercase;
    }
    
    .tier-count {
        font-size: 18px;
        font-weight: bold;
        color: #417690;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:index' %}#embeddings">Embeddings</a>
    &rsaquo; Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø³ÛŒØ³ØªÙ… Ù…Ø±Ú©Ø²ÛŒ
</div>
{% endblock %}

{% block content_title %}{% endblock %}

{% block content %}
<div class="stats-container">
    <h1>ğŸ“Š Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø³ÛŒØ³ØªÙ… Ù…Ø±Ú©Ø²ÛŒ (Core)</h1>
    
    <button class="refresh-button" onclick="location.reload()">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
    
    {% if error %}
        <div class="error-message">
            <strong>âŒ Ø®Ø·Ø§:</strong> {{ error }}
            <br><br>
            <strong>Ø¢Ø¯Ø±Ø³ Core:</strong> {{ core_url }}
        </div>
    {% elif stats %}
        <div class="timestamp">
            â° Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: {{ stats.timestamp }}
        </div>
        
        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card green">
                <div class="summary-label">ğŸ‘¥ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</div>
                <div class="summary-value">{{ stats.summary.total_users|floatformat:0 }}</div>
            </div>
            
            <div class="summary-card blue">
                <div class="summary-label">ğŸ’¬ Ù…Ú©Ø§Ù„Ù…Ø§Øª</div>
                <div class="summary-value">{{ stats.summary.total_conversations|floatformat:0 }}</div>
            </div>
            
            <div class="summary-card orange">
                <div class="summary-label">ğŸ“ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</div>
                <div class="summary-value">{{ stats.summary.total_messages|floatformat:0 }}</div>
            </div>
            
            <div class="summary-card purple">
                <div class="summary-label">ğŸ¯ Ø¨Ø±Ø¯Ø§Ø±Ù‡Ø§</div>
                <div class="summary-value">{{ stats.summary.total_vectors_in_qdrant|floatformat:0 }}</div>
            </div>
            
            <div class="summary-card red">
                <div class="summary-label">â­ Ø±Ø¶Ø§ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</div>
                <div class="summary-value">{{ stats.summary.avg_user_rating|floatformat:2 }}/5</div>
                <div class="rating-stars">â˜…â˜…â˜…â˜…â˜…</div>
            </div>
        </div>
        
        <!-- Detailed Stats Grid -->
        <div class="stats-grid">
            <!-- Users -->
            <div class="stat-card">
                <h3>ğŸ‘¥ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</span>
                    <span class="stat-value large">{{ stats.postgresql.users.total|floatformat:0 }}</span>
                </div>
                
                <div class="tier-breakdown">
                    <div class="tier-item">
                        <div class="tier-name">Free</div>
                        <div class="tier-count">{{ stats.postgresql.users.by_tier.free|floatformat:0 }}</div>
                    </div>
                    <div class="tier-item">
                        <div class="tier-name">Basic</div>
                        <div class="tier-count">{{ stats.postgresql.users.by_tier.basic|floatformat:0 }}</div>
                    </div>
                    <div class="tier-item">
                        <div class="tier-name">Premium</div>
                        <div class="tier-count">{{ stats.postgresql.users.by_tier.premium|floatformat:0 }}</div>
                    </div>
                    <div class="tier-item">
                        <div class="tier-name">Enterprise</div>
                        <div class="tier-count">{{ stats.postgresql.users.by_tier.enterprise|floatformat:0 }}</div>
                    </div>
                </div>
            </div>
            
            <!-- Conversations -->
            <div class="stat-card">
                <h3>ğŸ’¬ Ù…Ú©Ø§Ù„Ù…Ø§Øª</h3>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ù„ Ù…Ú©Ø§Ù„Ù…Ø§Øª</span>
                    <span class="stat-value">{{ stats.postgresql.conversations.total|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ú©Ø§Ù„Ù…Ø§Øª</span>
                    <span class="stat-value">{{ stats.postgresql.conversations.total_messages_in_conversations|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù¾ÛŒØ§Ù…/Ù…Ú©Ø§Ù„Ù…Ù‡</span>
                    <span class="stat-value">{{ stats.postgresql.conversations.avg_messages_per_conversation|floatformat:1 }}</span>
                </div>
            </div>
            
            <!-- Messages -->
            <div class="stat-card">
                <h3>ğŸ“ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</h3>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</span>
                    <span class="stat-value">{{ stats.postgresql.messages.total|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ø§Ø² Ú©Ø§Ø±Ø¨Ø±</span>
                    <span class="stat-value">{{ stats.postgresql.messages.user_messages|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ø§Ø² Ø¯Ø³ØªÛŒØ§Ø±</span>
                    <span class="stat-value">{{ stats.postgresql.messages.assistant_messages|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ù„ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§</span>
                    <span class="stat-value">{{ stats.postgresql.messages.total_tokens|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ø²Ù…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø²Ø´ (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†)</span>
                    <span class="stat-value">{{ stats.postgresql.messages.avg_processing_time_ms|floatformat:1 }} ms</span>
                </div>
            </div>
            
            <!-- Cache -->
            <div class="stat-card">
                <h3>ğŸ’¾ Ú©Ø´</h3>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ù„ Ú©Ø´ Ø´Ø¯Ù‡</span>
                    <span class="stat-value">{{ stats.postgresql.cache.total_cached_queries|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©Ø´</span>
                    <span class="stat-value">{{ stats.postgresql.cache.total_cache_hits|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ø´â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</span>
                    <span class="stat-value">{{ stats.postgresql.cache.active_cache_entries|floatformat:0 }}</span>
                </div>
                {% if stats.postgresql.cache.total_cached_queries > 0 %}
                <div class="stat-row">
                    <span class="stat-label">Ù†Ø±Ø® Ø§Ø³ØªÙØ§Ø¯Ù‡</span>
                    <span class="stat-value">{{ stats.postgresql.cache.total_cache_hits|floatformat:0 }} / {{ stats.postgresql.cache.total_cached_queries|floatformat:0 }}</span>
                </div>
                {% endif %}
            </div>
            
            <!-- Feedback -->
            <div class="stat-card">
                <h3>â­ Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ù„ Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯Ù‡Ø§</span>
                    <span class="stat-value">{{ stats.postgresql.feedback.total|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²</span>
                    <span class="stat-value large">{{ stats.postgresql.feedback.avg_rating|floatformat:2 }}/5</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯Ù‡</span>
                    <span class="stat-value">{{ stats.postgresql.feedback.processed|floatformat:0 }}</span>
                </div>
            </div>
            
            <!-- Qdrant -->
            <div class="stat-card">
                <h3>ğŸ¯ Qdrant Vector Database</h3>
                <div class="stat-row">
                    <span class="stat-label">Ú©Ù„ Ø¨Ø±Ø¯Ø§Ø±Ù‡Ø§</span>
                    <span class="stat-value large">{{ stats.qdrant.total_points|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Index Ø´Ø¯Ù‡</span>
                    <span class="stat-value">{{ stats.qdrant.indexed_vectors|floatformat:0 }}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">ÙˆØ¶Ø¹ÛŒØª</span>
                    <span class="stat-value">
                        <span class="status-badge status-{{ stats.qdrant.status }}">
                            {{ stats.qdrant.status|upper }}
                        </span>
                    </span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Collection</span>
                    <span class="stat-value">{{ stats.qdrant.collection_name }}</span>
                </div>
            </div>
        </div>
        
        <div class="success-message">
            âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø² Core Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù†Ø¯
        </div>
    {% else %}
        <div class="error-message">
            âš ï¸ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§...
        </div>
    {% endif %}
</div>
{% endblock %}
