{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">{{ site_header|default:_('Django administration') }}</a></h1>
{% endblock %}

{% block nav-global %}{% endblock %}

{% block content %}
<div class="module filtered" id="changelist">
    <div class="results">
        <div class="module">
            <h2>{{ title }}</h2>
            
            <!-- Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
            <div class="form-row">
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div class="card" style="background: #f8f9fa; padding: 15px; border-radius: 5px; flex: 1;">
                        <h3 style="margin: 0 0 10px 0; color: #333;">Ú†Ø§Ù†Ú©â€ŒÙ‡Ø§ (Chunks)</h3>
                        <p style="margin: 0; font-size: 14px;">
                            <strong>Ú©Ù„:</strong> {{ total_chunks }}<br>
                            <strong>Ø¯Ø§Ø±Ø§ÛŒ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯:</strong> {{ chunks_with_embeddings }}<br>
                            <strong>ÙØ§Ù‚Ø¯ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯:</strong> {{ chunks_missing }}
                        </p>
                    </div>
                    
                    <div class="card" style="background: #f8f9fa; padding: 15px; border-radius: 5px; flex: 1;">
                        <h3 style="margin: 0 0 10px 0; color: #333;">Ù¾Ø±Ø³Ø´ Ùˆ Ù¾Ø§Ø³Ø® (QA)</h3>
                        <p style="margin: 0; font-size: 14px;">
                            <strong>Ú©Ù„ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡:</strong> {{ total_qa }}<br>
                            <strong>Ø¯Ø§Ø±Ø§ÛŒ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯:</strong> {{ qa_with_embeddings }}<br>
                            <strong>ÙØ§Ù‚Ø¯ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯:</strong> {{ qa_missing }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Ø¢Ù…Ø§Ø± Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯ -->
            {% if chunk_stats or qa_stats %}
            <div class="form-row">
                <h3>Ø¢Ù…Ø§Ø± Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯</h3>
                
                {% if chunk_stats %}
                <h4>Ú†Ø§Ù†Ú©â€ŒÙ‡Ø§:</h4>
                <ul>
                    {% for stat in chunk_stats %}
                    <li>{{ stat.model_name }}: {{ stat.count }} Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯</li>
                    {% endfor %}
                </ul>
                {% endif %}
                
                {% if qa_stats %}
                <h4>Ù¾Ø±Ø³Ø´ Ùˆ Ù¾Ø§Ø³Ø®:</h4>
                <ul>
                    {% for stat in qa_stats %}
                    <li>{{ stat.model_name }}: {{ stat.count }} Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            
            <!-- Ù†Ú©ØªÙ‡ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ -->
            {% if chunks_missing == 0 and qa_missing == 0 %}
            <div style="background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #28a745;">
                <strong>ğŸ’¡ Ù†Ú©ØªÙ‡:</strong> Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯ Ø¯Ø§Ø±Ø§ÛŒ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯ Ù‡Ø³ØªÙ†Ø¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ø¯Ù„ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ú©ÛŒÙÛŒØª Ù…ØªÙØ§ÙˆØª ØªÙˆÙ„ÛŒØ¯ Ø´ÙˆÙ†Ø¯.
            </div>
            {% endif %}
            {% endif %}

            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ -->
            <div class="form-row" style="margin-top: 30px;">
                <div style="display: flex; gap: 10px;">
                    <!-- Ù‡Ù…ÛŒØ´Ù‡ Ø§Ù…Ú©Ø§Ù† ØªÙˆÙ„ÛŒØ¯ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯ Ø¨Ø§ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ -->
                    <form method="post" action="/admin/embeddings/generate-embeddings/" style="display: inline-block; margin-right: 10px;">
                        {% csrf_token %}
                        <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <label for="selected_model" style="font-weight: bold;">Ù…Ø¯Ù„:</label>
                                <select name="selected_model" id="selected_model" style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; min-width: 200px;">
                                    <option value="">Ù‡Ù…Ù‡ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</option>
                                    {% for model in available_models %}
                                    <option value="{{ model.name }}">{{ model.display_name }} ({{ model.dimension }}d)</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <label for="batch_size" style="font-weight: bold;">Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¯Ø³ØªÙ‡:</label>
                                <select name="batch_size" id="batch_size" style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;">
                                    <option value="8">8 ØªØ§ÛŒÛŒ</option>
                                    <option value="16">16 ØªØ§ÛŒÛŒ</option>
                                    <option value="32" selected>32 ØªØ§ÛŒÛŒ (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ)</option>
                                    <option value="64">64 ØªØ§ÛŒÛŒ</option>
                                    <option value="128">128 ØªØ§ÛŒÛŒ (Ø­Ø¯Ø§Ú©Ø«Ø±)</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-warning" style="background-color: #ffc107; color: #212529; border: 1px solid #ffc107; padding: 8px 16px; border-radius: 4px; cursor: pointer;"
                                onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² ØªÙˆÙ„ÛŒØ¯ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯ Ø¨Ø§ Ù…Ø¯Ù„ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§ Ù‡Ù…ÛŒÙ† Ù…Ø¯Ù„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.')">
                                ØªÙˆÙ„ÛŒØ¯/Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯â€ŒÙ‡Ø§
                            </button>
                        </div>
                    </form>
                    
                    {% if chunks_with_embeddings > 0 or qa_with_embeddings > 0 %}
                    <form method="post" action="/admin/embeddings/delete-embeddings/" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger" style="background-color: #dc3545; color: white; border: 1px solid #dc3545; padding: 8px 16px; border-radius: 4px; cursor: pointer;"
                            onclick="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù ØªÙ…Ø§Ù…ÛŒ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯â€ŒÙ‡Ø§ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.')">
                            Ø­Ø°Ù Ù‡Ù…Ù‡â€ŒÛŒ Ø§Ù…Ø¨Ø¯ÛŒÙ†Ú¯â€ŒÙ‡Ø§ ({{ chunks_with_embeddings|add:qa_with_embeddings }} Ù…ÙˆØ±Ø¯)
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</div>

<style>
.card {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.btn {
    display: inline-block;
    font-weight: 400;
    text-align: center;
    vertical-align: middle;
    user-select: none;
    border: 1px solid transparent;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    line-height: 1.5;
    border-radius: 0.25rem;
    transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    cursor: pointer;
    text-decoration: none;
}

.btn:hover {
    opacity: 0.8;
}

.btn-primary {
    color: #fff;
    background-color: #007cba;
    border-color: #007cba;
}

.btn-warning {
    color: #212529;
    background-color: #ffc107;
    border-color: #ffc107;
}

.btn-danger {
    color: #fff;
    background-color: #dc3545;
    border-color: #dc3545;
}
</style>
{% endblock %}
